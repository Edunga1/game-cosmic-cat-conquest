function t(t,e,i,s){Object.defineProperty(t,e,{get:i,set:s,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},s={},h={},r=i.parcelRequireaa2a;null==r&&((r=function(t){if(t in s)return s[t].exports;if(t in h){var e=h[t];delete h[t];var i={id:t,exports:{}};return s[t]=i,e.call(i.exports,i,i.exports),i.exports}var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(t,e){h[t]=e},i.parcelRequireaa2a=r),r.register("27Lyk",(function(e,i){var s,h;t(e.exports,"register",(()=>s),(t=>s=t)),t(e.exports,"resolve",(()=>h),(t=>h=t));var r={};s=function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)r[e[i]]=t[e[i]]},h=function(t){var e=r[t];if(null==e)throw new Error("Could not resolve bundle with id "+t);return e}})),r("27Lyk").register(JSON.parse('{"67Pf5":"index.6f24c07b.js","kp27Z":"cat-sprites-running.47e835c7.png","1H4Ur":"cat-sprites-idle.8767d413.png","7agUk":"confetti-sprites.0546130f.png"}'));class n{constructor(t,e){this.x=t,this.y=e,this.x=t,this.y=e}static zero(){return new n(0,0)}add(t){return new n(this.x+t.x,this.y+t.y)}subtract(t){return new n(this.x-t.x,this.y-t.y)}unit(){const t=this.length();return 0===t?n.zero():new n(this.x/t,this.y/t)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}multiply(t){return new n(this.x*t,this.y*t)}angle(){return Math.atan2(this.y,this.x)}distanceTo(t){return this.subtract(t).length()}limit(t){return this.length()>t?this.unit().multiply(t):this}around(t){const e=Math.random()*Math.PI*2;return new n(this.x+Math.cos(e)*t,this.y+Math.sin(e)*t)}}class o{hp=a.of(100);size=1;power=0;range=new a(1,10);attackPeriod=1e3;damage(t){this.hp.value-=t.power}}class a{constructor(t,e){this._value=t,this._max=e}static of(t){return new a(t,t)}set value(t){this._value=t,this._max=Math.max(t,this._max)}get value(){return this._value}set max(t){this._max=t,this._value=Math.min(t,this._value)}get max(){return this._max}}class l{collection=[];get length(){return this.collection.filter((t=>t.isAlive)).length}get first(){return this.collection[0]}includes(t){return this.collection.includes(t)}add(t){this.collection.push(t)}nearestMobilesInRange(t,e){return this.collection.filter((i=>i.isAlive&&i.position.distanceTo(t)<e))}}class c{constructor(t){this.context=t,this.observers=[],this.position=n.zero(),this.velocity=n.zero(),this.speed=1,this.direction=new n(0,0),this.lifetime=0,this.maxLifetime=1/0,this.isLiving=!0,this.attributes=new o,this.lastAttack=0,this.isAlive=!0,this.score=0,this.fame=0,this.enemies=new l}update(t){this.updateEssentials(t),this.afterUpdate()}render(t){}move(t){this.velocity=t.limit(this.speed),this.direction=t}moveToMobile(t){const e=t.position.subtract(this.position);if(e.length()<t.attributes.size)return void this.stop();const i=e.unit().multiply(t.attributes.size),s=e.subtract(i);this.move(s)}stop(){this.velocity=n.zero()}attack(t){if(this.lastAttack<this.attributes.attackPeriod)return!1;return 0!==t.filter((t=>this.attributes.range.value>=this.position.distanceTo(t.position)-t.attributes.size)).length&&(this.lastAttack=0,this.direction=t[0].position.subtract(this.position),t.forEach((t=>t.damage(this.attributes.power))),!0)}attackDirection(t){const e=this.position.add(t.unit().multiply(this.attributes.range.value)),i=this.enemies.nearestMobilesInRange(e,this.attributes.range.value),s=this.attack(i);return this.direction=t.unit(),s}isOpponent(t){return this.enemies.includes(t)}scoreByMobile(t){this.score+=t.fame}addObserver(t){this.observers.push(t)}notifyMobileAdded(t){this.observers.forEach((e=>e.onMobileAdded(t)))}checkLifetimeEnd(){return this.lifetime>this.maxLifetime}afterUpdate(){}updateEssentials(t){this.lifetime+=t,this.lastAttack+=t,this.position=this.position.add(this.velocity.multiply(t/5)),this.checkLifetimeEnd()&&this.onLifetimeEnd?.()}damage(t){this.attributes.hp.value-=t,this.attributes.hp.value<=0&&this.die()}die(){this.isAlive=!1,this.onDeath?.(this)}}class d{constructor(t,e,i,s=60,h=!0){this.image=t,this.frameWidth=e,this.frameHeight=i,this.framesPerSecond=s,this.loop=h,this.frameIndex=0,this.time=0,this.framesPerRow=0,this.imageLoaded=!1,this.loopCount=0,this.image.onload=()=>{this.imageLoaded=!0,this.framesPerRow=Math.floor(t.width/e)}}update(t){if(this.checkLoop())for(this.time+=t;this.time>1e3/this.framesPerSecond;)this.time-=1e3/this.framesPerSecond,this.frameIndex++,this.frameIndex>=this.framesPerRow*Math.floor(this.image.height/this.frameHeight)&&(this.frameIndex=0,this.loopCount++)}draw(t,e,i,s=n.zero()){if(!this.checkLoop())return;if(!this.imageLoaded)return;const h=Math.floor(this.frameIndex/this.framesPerRow),r=this.frameIndex%this.framesPerRow,o=s.x<0?1:-1;t.save(),t.scale(o,1),t.drawImage(this.image,r*this.frameWidth,h*this.frameHeight,this.frameWidth,this.frameHeight,e-this.frameWidth/2,i-this.frameHeight/2,this.frameWidth,this.frameHeight),t.restore()}checkLoop(){return this.loop||0===this.loopCount}}var u;u=new URL(r("27Lyk").resolve("kp27Z"),import.meta.url).toString();var p;let m;var g;p=new URL(r("27Lyk").resolve("1H4Ur"),import.meta.url).toString(),(g=m||(m={}))[g.IDLE=0]="IDLE",g[g.RUNNING=1]="RUNNING";class x extends c{sprites=new Map;mode=m.IDLE;static SPRITES=[{mode:m.IDLE,img:e(p),width:20,height:15,fps:5},{mode:m.RUNNING,img:e(u),width:22,height:16,fps:10}];constructor(t){super(t),this.attributes.hp.max=20,this.attributes.power=5,this.attributes.size=10,this.attributes.range.value=50,this.attributes.range.max=50,this.attributes.attackPeriod=0,x.SPRITES.forEach((({mode:t,img:e,width:i,height:s,fps:h})=>{const r=new Image;r.src=e,this.sprites.set(t,new d(r,i,s,h))}))}render(t){const e=this.sprites.get(this.mode);e?.update(t),e?.draw(this.context,0,0,this.direction)}move(t){super.move(t),this.mode=m.RUNNING}stop(){super.stop(),this.mode=m.IDLE,this.attackDirection(this.direction)}}class f extends c{constructor(t){super(t),this.attributes.hp.max=5,this.attributes.power=5,this.attributes.size=1,this.speed=.5,this.fame=1}render(){this.context.save(),this.context.rotate(this.direction.angle()+Math.PI/2),this.context.beginPath(),this.context.moveTo(0,-5),this.context.lineTo(5,5),this.context.lineTo(0,3),this.context.lineTo(-5,5),this.context.lineTo(0,-5),this.context.fillStyle="red",this.context.fill(),this.context.restore(),this.lastAttack>200||(this.context.save(),this.context.rotate(this.direction.angle()+Math.PI/2),this.context.beginPath(),this.context.moveTo(0,-4),this.context.lineTo(4,4),this.context.lineTo(0,2),this.context.lineTo(-4,4),this.context.lineTo(0,-4),this.context.fillStyle=`rgba(255, 255, 255, ${this.lastAttack/200})`,this.context.fill(),this.context.restore())}afterUpdate(){void 0!==this.enemies.first&&(this.moveToMobile(this.enemies.first),this.attack([this.enemies.first]))}}class y extends c{constructor(t,e){super(t),this.source=e,this.visible=!0,this.isLiving=!1}setVisible(t){this.visible=t}render(){if(!this.visible)return;const t=this.source.position.subtract(this.position);this.context.beginPath(),this.context.moveTo(0,0),this.context.lineTo(t.x,t.y),this.context.strokeStyle="#FFF",this.context.setLineDash([5,15]),this.context.stroke()}}var v;v=new URL(r("27Lyk").resolve("7agUk"),import.meta.url).toString();class b extends c{constructor(t,e){super(t),this.sprite=e,this.isLiving=!1}render(t){this.sprite.update(t),this.sprite.draw(this.context,0,0,this.direction)}checkLifetimeEnd(){return this.sprite.loopCount>0}}class w extends b{constructor(t){const i=new Image;i.src=e(v);super(t,new d(i,81,81,10,!1))}render(t){this.context.save();const e=this.direction.unit().multiply(30);this.context.translate(e.x,e.y),this.context.rotate(this.direction.angle()+Math.PI/2),super.render(t),this.context.restore()}}class E{constructor(t){this.context=t,this.width=0,this.height=0,this.starElapsed=0,this.backgroundColor="rgb(10, 10, 10)",this.starColorRange=100,this.stars=[],this.maxStars=400}animate(t){this.render(t)}resize(t,e){this.width=t,this.height=e}render(t){this.renderBackground(),this.renderStars(),this.checkStarElapsed(t)&&this.updateStars()}renderBackground(){this.context.fillStyle=this.backgroundColor,this.context.fillRect(0,0,this.width,this.height)}renderStars(){this.context.fillStyle="white",this.stars.forEach((t=>{this.context.fillRect(t.x,t.y,1,1)}))}updateStars(){this.stars=[];for(let t=0;t<this.maxStars;t++)this.stars.push(new n(Math.random()*this.width,Math.random()*this.height))}checkStarElapsed(t){return this.starElapsed+=t,this.starElapsed>200&&(this.starElapsed=0,!0)}}class k{constructor(t){this.game=t}update(){this.createEnemy()}createEnemy(){this.game.player&&(this.game.player.enemies.length>=10||this.game.createEnemy())}}class P{constructor(t){this.context=t,this.options={showCoordinates:!1},this.width=0,this.height=0,this.lastTime=0,this.delta=0,this.paused=!1,this.space=void 0,this.player=void 0,this.targetPoint=void 0,this.mobiles=[],this.gameLevel=new k(this),this.pausedTitle=void 0,this.pausedSubtitle=void 0,this.reset()}resize(t,e){this.width=t,this.height=e,this.space?.resize(t,e)}animate(t){this.renderSpace(),this.renderInterface(),this.paused?this.renderPauseMessage():(this.updateDelta(t),this.updateGameLevel(),this.updatePlayer(),this.updateMobiles(),this.processGameOver(),this.renderMobiles(),this.renderPlayer())}movePlayer(t,e){if(!this.player)return;const i=new n(t,e);this.player.move(i),this.targetPoint&&(this.targetPoint.position=this.player.position.add(i),this.targetPoint?.setVisible(!0))}stopPlayer(){this.player?.stop(),this.targetPoint?.setVisible(!1),this.createCatAttackEffect()}getSummary(){return`\n      Player:\n        * pos: ${this.player?.position.x}, ${this.player?.position.y}\n        * hp : ${this.player?.attributes.hp.value} / ${this.player?.attributes.hp.max}\n        * score: ${this.player?.score}\n      Mobiles: ${this.mobiles?.length}\n    `}createEnemy(){const t=new f(this.context);this.mobiles.push(t),this.player&&(t.position=this.player?.position.around(200*Math.random()+400),t.enemies.add(this.player),t.onDeath=this.scoreToPlayer.bind(this),this.player?.enemies.add(t))}pause(t,e){this.pausedTitle=t,this.pausedSubtitle=e,this.paused=!0}resume(){this.paused=!1}reset(){this.mobiles=[],this.space=new E(this.context),this.space.resize(this.width,this.height),this.player=new x(this.context),this.targetPoint=new y(this.context,this.player),this.mobiles.push(this.targetPoint),this.resume()}processGameOver(){this.player?.isAlive||this.pause("GAME OVER","Press any key to restart")}updatePlayer(){this.player?.update(this.delta)}renderPlayer(){this.context.save(),this.context.translate(this.width/2,this.height/2),this.player&&(this.player.render(this.delta),this.drawCoordinates(this.player,20)),this.context.restore()}updateMobiles(){this.mobiles.forEach((t=>t.update(this.delta)))}renderMobiles(){const t=this.mobiles.filter((t=>t.isAlive)),e=this.player?.position||new n(0,0);t.forEach((t=>{this.context.save(),this.context.translate(this.width/2-e.x+t.position.x,this.height/2-e.y+t.position.y),t.render(this.delta),this.drawCoordinates(t,10,5),this.context.restore()}))}updateGameLevel(){this.gameLevel.update()}updateDelta(t){this.delta=t-this.lastTime,this.lastTime=t}createCatAttackEffect(){if(!this.player)return;const t=new w(this.context);t.position=this.player.position,t.direction=this.player.direction,t.onLifetimeEnd=()=>{this.mobiles.splice(this.mobiles.indexOf(t),1)},this.mobiles.push(t)}drawCoordinates(t,e,i=8){if(!this.options.showCoordinates||!t.isLiving)return;this.context.fillStyle="white",this.context.font=`${i}px Arial`;const s=`${Math.round(t.position.x)}, ${Math.round(t.position.y)}`,h=s.length/4*i;this.context.fillText(s,-h,e)}scoreToPlayer(t){this.player?.scoreByMobile(t)}renderSpace(){this.space&&this.space.animate(this.delta)}renderInterface(){this.player&&(this.context.save(),this.context.fillStyle="white",this.context.font="16px Courier",this.context.fillText(this.player.score.toString(),this.width/2,20),this.context.restore())}renderPauseMessage(){if(!this.pausedTitle)return;this.context.save(),this.context.fillStyle="white",this.context.font="48px Courier",this.context.textAlign="center";const t=this.pausedTitle;if(this.context.fillText(t,this.width/2,this.height/2),this.context.restore(),!this.pausedSubtitle)return;this.context.save(),this.context.fillStyle="white",this.context.font="16px Courier",this.context.textAlign="center";const e=this.pausedSubtitle;this.context.fillText(e,this.width/2,this.height/2+48),this.context.restore()}}class T{width=0;height=0;isControllingPlayer=!1;keys=[];constructor(){this.canvas=document.createElement("canvas");const t=this.canvas.getContext("2d");if(!t)throw new Error("Could not get canvas context");this.context=t,this.game=new P(this.context)}start(){document.body.appendChild(this.canvas),window.addEventListener("resize",this.resize.bind(this)),this.registerCanvasEvents(),this.resize(),this.animate()}enableDebugMode(){return this.game.options.showCoordinates=!0,setInterval((()=>{console.log(this.game.getSummary())}),3e3),this}animate(t=0){this.game.animate(t),requestAnimationFrame(this.animate.bind(this))}resize(){this.width=document.body.clientWidth,this.height=document.body.clientHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.game.resize(this.width,this.height)}registerCanvasEvents(){this.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),this.canvas.addEventListener("mousemove",this.onMouseMove.bind(this)),this.canvas.addEventListener("mouseup",this.onTouchEnd.bind(this)),this.canvas.addEventListener("touchstart",this.onTouchStart.bind(this)),this.canvas.addEventListener("touchmove",this.onTouchStart.bind(this)),this.canvas.addEventListener("touchend",this.onTouchEnd.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this)),document.addEventListener("keyup",this.onKeyUp.bind(this))}movePlayer(t,e){!1!==this.game.player?.isAlive||this.isControllingPlayer||this.game.reset(),this.isControllingPlayer=!0,this.game.movePlayer(t,e)}endMovePlayer(){this.isControllingPlayer=!1,this.game.stopPlayer()}onMouseDown(t){this.movePlayer(...this.calculateDistanceFromCenter(t.clientX,t.clientY))}onMouseMove(t){0!==t.buttons&&this.movePlayer(...this.calculateDistanceFromCenter(t.clientX,t.clientY))}onTouchStart(t){this.movePlayer(...this.calculateDistanceFromCenter(t.touches[0].clientX,t.touches[0].clientY))}onTouchEnd(){this.endMovePlayer()}calculateDistanceFromCenter(t,e){const i=new n(this.width/2,this.height/2),s=new n(t,e).subtract(i);return[s.x,s.y]}onKeyDown(t){t.key in T.KEY_TO_DIRECTION&&(this.keys.includes(t.key)||(this.keys.push(t.key),this.updateKeys()))}onKeyUp(t){t.key in T.KEY_TO_DIRECTION&&(this.keys=this.keys.filter((e=>e!==t.key)),this.updateKeys())}updateKeys(){if(0===this.keys.length)return void this.endMovePlayer();const t=this.keys.reduce(((t,e)=>[t[0]+T.KEY_TO_DIRECTION[e][0],t[1]+T.KEY_TO_DIRECTION[e][1]]),[0,0]);this.movePlayer(t[0],t[1])}static KEY_TO_DIRECTION={w:[0,-1],a:[-1,0],s:[0,1],d:[1,0],ArrowUp:[0,-1],ArrowLeft:[-1,0],ArrowDown:[0,1],ArrowRight:[1,0]}}(new T).enableDebugMode().start();
//# sourceMappingURL=index.6f24c07b.js.map
